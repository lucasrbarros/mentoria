{% extends "base.html" %}

{% block title %}Chamado #{{ chamado.id }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">{{ chamado.entidade }}</h4>
                <span class="badge status-{{ chamado.status }}">
                    {% if chamado.status == 'pendente' %}
                        <i class="bi bi-clock"></i> Pendente
                    {% elif chamado.status == 'em_atendimento' %}
                        <i class="bi bi-person-check"></i> Em Atendimento
                    {% else %}
                        <i class="bi bi-check-circle"></i> Resolvido
                    {% endif %}
                </span>
            </div>
            <div class="card-body">
                <h5 class="card-title">Dúvida/Erro</h5>
                <p class="card-text">{{ chamado.duvida_erro }}</p>

                <h5 class="card-title mt-4">Validações realizadas</h5>
                <p class="card-text">{{ chamado.validacoes or 'Nenhuma validação registrada.' }}</p>

                <h5 class="card-title mt-4">Outros clientes</h5>
                <p class="card-text">{{ chamado.outros_clientes or 'Não informado.' }}</p>

                <div class="mt-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" disabled {% if chamado.consultou_movidesk %}checked{% endif %}>
                        <label class="form-check-label">
                            Consultou histórico de chamados no Movidesk?
                        </label>
                    </div>
                </div>

                {% if chamado.print_path %}
                <div class="mt-4">
                    <h5 class="card-title">Print de tela</h5>
                    <img src="{{ url_for('static', filename='uploads/' + chamado.print_path) }}" class="img-fluid rounded" alt="Print de tela">
                </div>
                {% endif %}

                {% if chamado.link_ambiente %}
                <div class="mt-4">
                    <h5 class="card-title">Link do ambiente</h5>
                    <a href="{{ chamado.link_ambiente }}" target="_blank" class="btn btn-outline-primary">
                        <i class="bi bi-box-arrow-up-right"></i> Abrir ambiente
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Informações do chamado</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="bi bi-person"></i> <strong>Aberto por:</strong><br>
                        {{ chamado.autor.username }}
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-clock"></i> <strong>Criado em:</strong><br>
                        {{ (chamado.created_at - timedelta(hours=3)).strftime('%d/%m/%Y %H:%M') }}
                    </li>
                    {% if chamado.atendente %}
                    <li class="mb-2">
                        <i class="bi bi-person-check"></i> <strong>Atendido por:</strong><br>
                        {{ chamado.atendente.username }}
                    </li>
                    {% endif %}
                    <li class="mb-2">
                        <i class="bi bi-flag"></i> <strong>Prioridade:</strong><br>
                        {% if chamado.prioridade == 2 %}
                            <span class="badge bg-danger">Urgente</span>
                        {% elif chamado.prioridade == 1 %}
                            <span class="badge bg-warning">Alta</span>
                        {% else %}
                            <span class="badge bg-info">Normal</span>
                        {% endif %}
                    </li>
                </ul>

                {% if current_user.is_senior %}
                <div class="mt-4">
                    {% if chamado.status == 'pendente' %}
                    <a href="{{ url_for('chamados.atender', id=chamado.id) }}" class="btn btn-warning w-100 mb-2">
                        <i class="bi bi-person-check"></i> Atender Chamado
                    </a>
                    {% elif chamado.status == 'em_atendimento' and chamado.atendente_id == current_user.id %}
                    <a href="{{ url_for('chamados.resolver', id=chamado.id) }}" class="btn btn-success w-100">
                        <i class="bi bi-check-circle"></i> Marcar como Resolvido
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 